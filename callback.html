<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authenticating with Twitter - Monad Voices</title>
    <link rel="icon" type="image/png" href="monad.png">
    <link rel="stylesheet" href="style.css">
    <style>
        .callback-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--color-bg-1) 0%, var(--color-bg-3) 50%, var(--color-bg-5) 100%);
        }
        
        .callback-card {
            background: var(--color-surface);
            border-radius: var(--radius-lg);
            padding: var(--space-32);
            text-align: center;
            box-shadow: var(--shadow-lg);
            max-width: 400px;
            width: 90%;
        }
        
        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 4px solid var(--color-secondary);
            border-top: 4px solid var(--color-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto var(--space-16);
        }
        
        .callback-title {
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-semibold);
            margin-bottom: var(--space-8);
            color: var(--color-text);
        }
        
        .callback-message {
            color: var(--color-text-secondary);
            margin-bottom: var(--space-16);
        }
        
        .error-message {
            color: var(--color-error);
            margin-top: var(--space-16);
        }
        
        .retry-btn {
            margin-top: var(--space-16);
        }
    </style>
</head>
<body>
    <div class="callback-container">
        <div class="callback-card">
            <div class="loading-spinner"></div>
            <h1 class="callback-title">Authenticating with Twitter</h1>
            <p class="callback-message">Please wait while we verify your account...</p>
            <div id="error-container" class="error-message" style="display: none;">
                <p>Authentication failed. Please try again.</p>
                <button class="btn btn--primary retry-btn" onclick="window.location.href='index.html'">
                    Go Back
                </button>
            </div>
        </div>
    </div>

    <script src="twitter-config.js"></script>
    <script>
        // Handle the OAuth callback
        async function handleCallback() {
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');
            const state = urlParams.get('state');
            const error = urlParams.get('error');
            
            if (error) {
                showError('Authentication was cancelled or failed.');
                return;
            }
            
            if (!code || !state) {
                showError('Missing authorization parameters.');
                return;
            }
            
            try {
                // In a real implementation, you would send the code to your server
                // to exchange it for an access token and fetch user data
                
                // For demo purposes, we'll simulate the process
                await new Promise(resolve => setTimeout(resolve, 2000)); // Simulate API call
                
                // Mock user data (replace with real API call)
                const mockUserData = {
                    id: '123456789',
                    name: 'Demo User',
                    username: 'demo_user',
                    profile_image_url: 'https://pbs.twimg.com/profile_images/1234567890/demo_400x400.jpg'
                };
                
                // Store user data
                localStorage.setItem('twitter_user_data', JSON.stringify(mockUserData));
                localStorage.setItem('twitter_auth_time', Date.now().toString());
                
                // Redirect back to main page
                window.location.href = 'index.html';
                
            } catch (error) {
                console.error('Authentication error:', error);
                showError('Failed to authenticate with Twitter. Please try again.');
            }
        }
        
        function showError(message) {
            document.querySelector('.loading-spinner').style.display = 'none';
            document.querySelector('.callback-title').textContent = 'Authentication Failed';
            document.querySelector('.callback-message').textContent = message;
            document.getElementById('error-container').style.display = 'block';
        }
        
        // Start the authentication process
        handleCallback();
    </script>
</body>
</html> 